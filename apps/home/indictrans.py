# -*- coding: utf-8 -*-
"""indicTrans_python_interface.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/github/AI4Bharat/indicTrans/blob/main/indicTrans_python_interface.ipynb
"""

# Commented out IPython magic to ensure Python compatibility.
# clone the repo for running evaluation
# %cd indicTrans
# clone requirements repositories

# # add fairseq folder to python path
import os
# os.environ['PYTHONPATH'] += ":/content/fairseq/"
# sanity check to see if fairseq is installed
# from fairseq import checkpoint_utils, distributed_utils, options, tasks, utils

from django.conf import settings

# from indicTrans.inference.engine import Model

import requests
import json

model_path = settings.MODEL_ROOT  + '/en-indic/'

def get_translated(input, language):
    if language == 'Hindi':
        lang = 'hi'
    elif language == 'Tamil':
        lang = 'ta'
    elif language == 'Kannada':
        lang = 'ka'
    elif language == 'Telugu':
        lang = 'tu'
    elif language == 'Assamese':
        lang = 'as'
    elif language == 'Marathi':
        lang = 'mr'
    elif language == 'Bengali':
        lang = 'bn'
    elif language == 'Odia':
        lang = 'or'
    elif language == 'Gujarati':
        lang = 'gu'
    elif language == 'Malayalam':
        lang = 'ml'
    elif language == 'Punjabi':
        lang = 'pa'
    all_output = ""
    # if len(input):
    #     response = requests.post("http://216.48.181.177:5050/translate_sentence",
    #         json={
    #         "text": input ,
    #         "source_language": "en",
    #         "target_language":lang
    #         },
    #     )
    #     output = json.loads(response.text)['text']
    #     all_output += output + '.'
    r = requests.post(url='https://hf.space/embed/hussain-shk/english-to-indic-translation/+/api/predict/', json={"data": [input,language]})
    all_output = r.json()['data']
    print(all_output)


    # en2indic_model = Model(expdir=model_path)

    # ta_sents = ['He seems to know us.',
    #             "We will follow you or continue to follow you",
    #             'If you develop these symptoms in someone close to you, staying at home can help prevent the spread of Corona virus infection.']
    # all_output = en2indic_model.translate_paragraph(input, 'en', lang)



    return all_output[0]



"""# New section"""

# Commented out IPython magic to ensure Python compatibility.
# Install the necessary libraries
#!pip install sacremoses pandas mock sacrebleu tensorboardX pyarrow indic-nlp-library
#! pip install mosestokenizer subword-nmt
# Install fairseq from source
#!git clone https://github.com/pytorch/fairseq.git
# %cd fairseq
# !git checkout da9eaba12d82b9bfc1442f0e2c6fc1b895f4d35d
#!pip install ./
#! pip install xformers
# %cd ..


